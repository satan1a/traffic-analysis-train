
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.8">
    
    
      
        <title>ASCOLIMITED - Traffic Analysis Train</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6e60f8b8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="red">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ascolimited" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href=".." title="Traffic Analysis Train" class="md-header__button md-logo" aria-label="Traffic Analysis Train" data-md-component="logo">
      
  <img src="../assets/logo_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Traffic Analysis Train
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ASCOLIMITED
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/satan1a/traffic-analysis-train/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Toky/TrafficAnalysis
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Traffic Analysis Train" class="md-nav__button md-logo" aria-label="Traffic Analysis Train" data-md-component="logo">
      
  <img src="../assets/logo_white.png" alt="logo">

    </a>
    Traffic Analysis Train
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/satan1a/traffic-analysis-train/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Toky/TrafficAnalysis
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Index
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0x0_%E7%9B%B8%E5%85%B3%E5%8F%82%E8%80%83/" class="md-nav__link">
        相关参考
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0x1_23-8-2020/" class="md-nav__link">
        PIZZA-BENDER
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0x2_24-8-2020/" class="md-nav__link">
        Pcap and alerts for an ISC diary
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0x3_26-8-2020/" class="md-nav__link">
        TECSOLUTIONS
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0x4_27-8-2020/" class="md-nav__link">
        FRANK-N-TED (WHAT'S GOING ON?)
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0x5_29-8-2020/" class="md-nav__link">
        CATBOMBER
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0x6_1-9-2020/" class="md-nav__link">
        STEELCOFFEE
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0x7_7-9-2020/" class="md-nav__link">
        MONDOGREEK
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0x8_22-9-2020/" class="md-nav__link">
        PCAP AND INFO FOR AN ISC DIARY
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0x9_14-3-2021/" class="md-nav__link">
        TROUBLE ALERT
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          ASCOLIMITED
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        ASCOLIMITED
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    题目
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    调查过程
  </a>
  
    <nav class="md-nav" aria-label="调查过程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    资产排查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    载荷排查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    感染路径排查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    域控通讯情况
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    结果
  </a>
  
    <nav class="md-nav" aria-label="结果">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    攻击总结
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    受害者信息
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iocs" class="md-nav__link">
    IOCs
  </a>
  
    <nav class="md-nav" aria-label="IOCs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain" class="md-nav__link">
    Domain
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    IP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sha256" class="md-nav__link">
    SHA256
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    标准答案
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../0xB_18-10-2021/" class="md-nav__link">
        ANGRYPOUTINE
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    题目
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    调查过程
  </a>
  
    <nav class="md-nav" aria-label="调查过程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    资产排查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    载荷排查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    感染路径排查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    域控通讯情况
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    结果
  </a>
  
    <nav class="md-nav" aria-label="结果">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    攻击总结
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    受害者信息
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iocs" class="md-nav__link">
    IOCs
  </a>
  
    <nav class="md-nav" aria-label="IOCs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#domain" class="md-nav__link">
    Domain
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    IP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sha256" class="md-nav__link">
    SHA256
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    标准答案
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/satan1a/traffic-analysis-train/edit/master/docs/0xA_17-10-2021.md" title="编辑此页" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="ascolimited">ASCOLIMITED</h1>
<h2 id="_1">题目</h2>
<blockquote>
<p>ASSOCIATED FILES:</p>
<ul>
<li>
<p>Zip archive of the pcap: <a href="https://www.malware-traffic-analysis.net/2021/02/08/2021-02-08-traffic-analysis-exercise.pcap.zip">2021-02-08-traffic-analysis-exercise.pcap.zip</a>  6.0 MB (6,017,342 bytes)</p>
<ul>
<li>2021-02-08-traffic-analysis-exercise.pcap  (11,145,351 bytes)</li>
</ul>
</li>
<li>
<p>Zip archive of the alerts: <a href="https://www.malware-traffic-analysis.net/2021/02/08/2021-02-08-traffic-analysis-exercise-alerts.zip">2021-02-08-traffic-analysis-exercise-alerts.zip</a>  2.0 MB (2,011,409 bytes)</p>
<ul>
<li>2021-02-08-traffic-analysis-exercise-alerts.jpg  (2,237,669 bytes)</li>
<li>2021-02-08-traffic-analysis-exercise-alerts.txt  (6,442 bytes)</li>
</ul>
</li>
</ul>
<p>NOTES:</p>
<ul>
<li>All zip archives on this site are password-protected with the standard password. If you don't know it, look at the "about" page of this website.</li>
</ul>
<p>SCENARIO</p>
<p>LAN segment data:</p>
<ul>
<li>LAN segment range: 10.2.8.0/24 (10.2.8.0 through 10.2.8.255)</li>
<li>Domain: ascolimited.com</li>
<li>Domain controller: 10.2.8.2 - AscoLimited-DC</li>
<li>LAN segment gateway: 10.2.8.1</li>
<li>LAN segment broadcast address: 10.2.8.255</li>
</ul>
<p>TASK</p>
<ul>
<li>
<p>Write an incident report based on the pcap and the alerts.</p>
</li>
<li>
<p>The incident report should contains 3 sections:</p>
<ul>
<li><strong>Executive Summary</strong>: State in simple, direct terms what happened (when, who, what).</li>
<li><strong>Details</strong>: Details of the victim (hostname, IP address, MAC address, Windows user account name).</li>
<li><strong>Indicators of Compromise (IOCs)</strong>: IP addresses, domains and URLs associated with the infection. SHA256 hashes if any malware binaries can be extracted from the pcap.</li>
</ul>
</li>
</ul>
<p>ANSWERS</p>
<ul>
<li>Click <a href="https://www.malware-traffic-analysis.net/2021/02/08/page2.html">here</a> for the answers.</li>
</ul>
</blockquote>
<h2 id="_2">调查过程</h2>
<p>本次分析会额外使用Brim分析工具，该工具分析较大数据包的处理效率比Wireshark较高一些，并且功能上也更偏向于安全角度，比如内置Zeek、自动计算JA3/S、自动生成告警等。但是在一些对象导出、统计功能上还是略逊于Wireshark的。</p>
<p>根据题目中的要求，本次的任务目标为：</p>
<ul>
<li>攻击总结：何时、谁、做了什么</li>
<li>受害者信息：Hostname、IP地址、MAC地址、Windows用户名</li>
<li>IOCs（失陷指标）：与感染相关的IP地址、域名、URL等，恶意软件的SHA256（如果流量包中存在）</li>
</ul>
<h3 id="_3">资产排查</h3>
<p>首先明确我们的已有资产：</p>
<pre><code class="language-bash">LAN segment data:
-   LAN segment range: 10.2.8.0/24 (10.2.8.0 through 10.2.8.255)
-   Domain: ascolimited.com
-   Domain controller: 10.2.8.2 - AscoLimited-DC
-   LAN segment gateway: 10.2.8.1
-   LAN segment broadcast address: 10.2.8.255
</code></pre>
<p>通常来说，我们可以分析流量中的DNS、NBNS、LDAP协议来发现网络流量通讯中的主机信息，而主机信息又包括基本三要素：IP地址、MAC地址、主机名（Hostname）。</p>
<p>使用Wireshark的IPv4统计所得全部通讯IPv4地址：</p>
<pre><code class="language-bash">
=================================================================================================================================
IPv4 Statistics/All Addresses:
Topic / Item      Count         Average       Min Val       Max Val       Rate (ms)     Percent       Burst Rate    Burst Start  
---------------------------------------------------------------------------------------------------------------------------------
All Addresses     20471                                                   0.0171        100%          7.5900        126.112      
 10.2.8.1         12                                                      0.0000        0.06%         0.0200        195.772      
 10.2.8.101       20471                                                   0.0171        100.00%       7.5900        126.112      
 10.2.8.2         1642                                                    0.0014        8.02%         1.9300        4.049        
 10.2.8.255       35                                                      0.0000        0.17%         0.0300        3.082        
 13.107.246.13    31                                                      0.0000        0.15%         0.2000        541.040      
 13.107.42.23     31                                                      0.0000        0.15%         0.1700        51.937       
 142.250.138.94   17                                                      0.0000        0.08%         0.1500        52.976       
 162.241.149.195  260                                                     0.0002        1.27%         0.3500        64.236       
 172.217.12.33    41                                                      0.0000        0.20%         0.2000        52.501       
 172.217.6.138    46                                                      0.0000        0.22%         0.2000        52.405       
 173.222.49.224   23                                                      0.0000        0.11%         0.1200        66.205       
 173.223.201.150  789                                                     0.0007        3.85%         1.9200        55.779       
 185.100.65.29    9608                                                    0.0080        46.93%        7.5900        126.112      
 198.211.10.238   5452                                                    0.0045        26.63%        1.8100        118.452      
 204.79.197.200   152                                                     0.0001        0.74%         0.3600        32.025       
 204.79.197.219   30                                                      0.0000        0.15%         0.1700        64.347       
 213.5.229.12     106                                                     0.0001        0.52%         0.0400        115.542      
 216.58.194.142   56                                                      0.0000        0.27%         0.2600        51.936       
 216.58.194.99    79                                                      0.0001        0.39%         0.4900        52.777       
 224.0.0.22       7                                                       0.0000        0.03%         0.0400        3.004        
 224.0.0.251      16                                                      0.0000        0.08%         0.0300        55.711       
 224.0.0.252      15                                                      0.0000        0.07%         0.0300        55.711       
 23.47.52.108     11                                                      0.0000        0.05%         0.0600        262.633      
 23.47.52.180     64                                                      0.0001        0.31%         0.4600        56.098       
 239.255.255.250  15                                                      0.0000        0.07%         0.0200        122.659      
 40.126.26.132    20                                                      0.0000        0.10%         0.1000        107.458      
 45.124.85.55     644                                                     0.0005        3.15%         2.0500        63.029       
 52.109.2.1       23                                                      0.0000        0.11%         0.0900        107.220      
 52.109.6.42      207                                                     0.0002        1.01%         1.0600        106.811      
 52.109.88.34     65                                                      0.0001        0.32%         0.1900        173.599      
 52.113.195.132   61                                                      0.0001        0.30%         0.3900        107.492      
 52.114.128.10    21                                                      0.0000        0.10%         0.1000        29.681       
 52.114.132.23    77                                                      0.0001        0.38%         0.2200        332.450      
 52.114.32.25     78                                                      0.0001        0.38%         0.1900        202.527      
 52.114.74.44     63                                                      0.0001        0.31%         0.0600        605.831      
 52.114.77.164    47                                                      0.0000        0.23%         0.0600        903.260      
 52.170.57.27     100                                                     0.0001        0.49%         0.2700        116.571      
 52.242.211.89    29                                                      0.0000        0.14%         0.1100        541.218      
 52.242.97.97     51                                                      0.0000        0.25%         0.1600        606.723      
 52.250.46.237    114                                                     0.0001        0.56%         0.3500        605.662      
 54.235.147.252   19                                                      0.0000        0.09%         0.0600        118.565      
 72.21.91.29      2                                                       0.0000        0.01%         0.0200        71.279       
 8.208.10.147     312                                                     0.0003        1.52%         1.1200        118.275      

---------------------------------------------------------------------------------------------------------------------------------
</code></pre>
<p>注意到，在内网资产中的IP通讯数量为：</p>
<pre><code class="language-bash"> 10.2.8.1         12
 10.2.8.101       20471   
 10.2.8.2         1642
 10.2.8.255       35
</code></pre>
<p>其中<code>10.2.8.2</code>为域控制器，需要重点关注；其中<code>10.2.8.101</code>为疑似内网主机，疑似感染，通讯数量较多、较异常。</p>
<h3 id="_4">载荷排查</h3>
<p>排查主机<code>10.2.8.101</code>的HTTP通讯数据，分析对象中是否有可疑文件：</p>
<p><img alt="image-20211017140712722" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017140712722.png" /></p>
<p>图：HTTP通讯对象</p>
<p>发现有exe后缀的可疑文件（<code>6lhjgfdghj.exe</code>），并且通讯的主机也是疑似感染的内网主机：<code>10.2.8.101</code>，并且注意到，通讯的外部域名为：<code>roanokemortgages.com</code>。</p>
<p>首先导出文件，上传至VT进行扫描（如不能联网通讯可使用<a href="https://cuckoosandbox.org/">Cuckoo沙箱</a>）:</p>
<p><img alt="image-20211017141359886" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017141359886.png" /></p>
<p>图：VT扫描结果</p>
<p>可以发现，明显报毒，我们认为该文件为载荷（之一）。</p>
<h3 id="_5">感染路径排查</h3>
<p>通过上述排查载荷，定位到frame序号为<code>4500</code>，我们以此为界，进行感染路径的排查。</p>
<p><img alt="image-20211017142235786" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017142235786.png" /></p>
<p>图：定位到特定序号的frame</p>
<p>可以发现，在<code>10.2.8.101</code>下载恶意文件前，其与外部IP：<code>45.124.85.55</code>有频繁通讯记录，对其进行排查。</p>
<p>follow该TCP通讯流，可以发现该通讯是一次访问Web网页的行为，并且访问的URL为：<code>http://tonmatdoanminh.com/uninviting.php</code>，如下：</p>
<p><img alt="image-20211017202724917" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017202724917.png" /></p>
<p>图：follw TCP流结果</p>
<p>在访问该网页后，即下载了一个压缩文件：</p>
<p><img alt="image-20211017202934700" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017202934700.png" /></p>
<p>图：下载文件的行为</p>
<p>我们尝试导出文件：</p>
<p><img alt="image-20211017203131191" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017203131191.png" /></p>
<p>图：导出下载文件</p>
<p>在命令行中查看<code>uninviting(1).php</code>文件可以发现，该网页文件的内容是下载一个Base64加密的.doc后缀文件（<code>0208_54741869750132.doc</code>）。以下是<code>uninviting(1).php</code>的开头和结尾部分：</p>
<p><img alt="image-20211017210249979" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017210249979.png" /></p>
<p>图：文件开头
<img alt="image-20211017210455150" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017210455150.png" /></p>
<p>图：文件结尾</p>
<p>对文件中对的Base64加密部分还原为文件，得到载荷：<code>0208_54741869750132.doc</code>，上传VT后发现其网络行为与流量包中一致：</p>
<p><img alt="image-20211017211309836" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017211309836.png" /></p>
<p>图：VT样本网络行为分析页面</p>
<p>流量包中的HTTP对象访问列表：</p>
<p><img alt="image-20211017211424136" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017211424136.png" /></p>
<p>图：HTTP对象信息</p>
<p>排查<code>api.ipify.org</code>和<code>satursed.com</code>后，发现前者是一个用于得到本机公网出口IP的API服务，为正常服务。而后者疑似恶意，继续排查。</p>
<p>以下是<code>0208_54741869750132.doc</code>文档的页面：</p>
<p><img alt="image-20211017212418130" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017212418130.png" /></p>
<p>图：恶意文档的页面</p>
<p>其中诱导用户编辑文档，在用户开启编辑模式后，会自动执行宏病毒，从而感染主机。接下来则继续访问<code>198.211.10.228:8080</code>和<code>roanokemortgages.com</code> ，下载后门程序：<code>6Aov</code>和 <code>6lhjgfdghj.exe</code>。</p>
<h3 id="_6">域控通讯情况</h3>
<p>排查域控地址通讯情况：</p>
<p><img alt="image-20211017215240768" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017215240768.png" /></p>
<p>图：域控通讯情况</p>
<p>对域控地址的排查，主要是为了判断攻击者是否有借助受害主机来进行<strong>横向移动</strong>的行为，用来判断域控的失陷情况。</p>
<h2 id="_7">结果</h2>
<h3 id="_8">攻击总结</h3>
<p>主机<code>10.2.8.101</code>访问恶意网页：<code>roanokemortgages.com</code>后，下载恶意文档：<code>0208_54741869750132.doc</code>。在用户打开并编辑文档后，该恶意文档进一步下载<code>6Aov</code>和 <code>6lhjgfdghj.exe</code>两个后门程序，进一步控制受害主机。</p>
<h3 id="_9">受害者信息</h3>
<p>通过NBNS通讯中的信息获取感染主机的MAC地址：</p>
<p><img alt="image-20211017214239330" src="https://image-host-toky.oss-cn-shanghai.aliyuncs.com/image-20211017214239330.png" /></p>
<p>图：NBNS通讯信息</p>
<table>
<thead>
<tr>
<th>IP</th>
<th>MAC</th>
<th>Hostname</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.2.8.101</td>
<td>00:12:79:41:c2:aa</td>
<td>HewlettP_41</td>
</tr>
</tbody>
</table>
<h3 id="iocs">IOCs</h3>
<h4 id="domain">Domain</h4>
<ul>
<li>tonmatdoanminh[.]com</li>
<li>roanokemortgages[.]com</li>
<li>satursed[.]com</li>
</ul>
<h4 id="ip">IP</h4>
<ul>
<li>8[.]208[.]10[.]127</li>
<li>198[.]211[.]10[.228:8080</li>
</ul>
<h4 id="sha256">SHA256</h4>
<ul>
<li>
<p>94e60de577c84625da69f785ffe7e24c889bfa6923dc7b017c21e8a313e4e8e1</p>
</li>
<li>
<p>3a5648f7de99c4f87331c36983fc8adcd667743569a19c8dafdd5e8a33de154d</p>
</li>
</ul>
<h2 id="_10">标准答案</h2>
<p>在对标准答案后，自己的分析过程主要有以下不足：</p>
<ul>
<li>Hostname弄错了，实际为：<code>DESKTOP-MGVG60Z</code></li>
<li>受害者信息中，对于主机，遗漏了主机用户名的搜集，为：<code>bill.cook</code></li>
<li>没有对载荷进行区分，实际该主机感染了三种<strong>不同类型</strong>的恶意软件，为Hancitor、 Cobalt Strike和 Ficker Stealer：</li>
</ul>
<blockquote>
<ul>
<li>Traffic for Hancitor:<ul>
<li>45.124.85.55 port 80 - <strong>tonmatdoanminh.com</strong> - GET /uninviting.php</li>
<li>port 80 - api.ipify.org - GET /</li>
<li>213.5.229.12 port 80 - <strong>satursed.com</strong> - POST /8/forum.php</li>
</ul>
</li>
<li>Traffic for Cobalt Strike:<ul>
<li>8.208.10.147 port 80 - <strong>roanokemortgages.com</strong> - GET /0801.bin</li>
<li>8.208.10.147 port 80 - <strong>roanokemortgages.com</strong> - GET /0801s.bin</li>
<li>198.211.10.238 port 8080 - <strong>198.211.10.238:8080</strong> - GET /6Aov</li>
<li>198.211.10.238 port 443 - HTTPS traffic</li>
<li>198.211.10.238 port 8080 - <strong>198.211.10.238:8080</strong> - GET /ca</li>
<li>198.211.10.238 port 8080 - <strong>198.211.10.238:8080</strong> - POST/submit.php?id=3275377518 </li>
</ul>
</li>
<li>Traffic for Ficker Stealer:<ul>
<li>8.208.10.147 port 80 - <strong>roanokemortgages.com</strong> - GET /6lhjgfdghj.exe</li>
<li>port 80 - api.ipify.org - GET /?format=xml</li>
<li>185.100.65.29 port 80 - <strong>sweyblidian.com</strong> - TCP traffic caused by Ficker Stealer</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li>少发现了一种恶意软件：Ficker Stealer</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="页脚">
      
        
        <a href="../0x9_14-3-2021/" class="md-footer__link md-footer__link--prev" aria-label="上一页: TROUBLE ALERT" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              TROUBLE ALERT
            </div>
          </div>
        </a>
      
      
        
        <a href="../0xB_18-10-2021/" class="md-footer__link md-footer__link--next" aria-label="下一页: ANGRYPOUTINE" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              ANGRYPOUTINE
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.960e086b.min.js"></script>
      
    
  </body>
</html>